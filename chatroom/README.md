# Chatroom - 临时云聊天室 🎉

一个轻量级、功能完整的临时聊天室应用，专为小团队和朋友间的临时沟通设计。

## ✨ 核心特性

### 💬 实时通讯
- WebSocket 实时聊天
- 临时房间（1-72 小时自动过期）
- 密码保护
- 断线重连（30 分钟保护期）
- 设备识别

### 📎 媒体分享
- **图片** - 预览 + 点击查看原图
- **视频** - 缩略图 + 点击弹窗播放
- **音频** - 播放器 + 下载按钮
- **文件** - 支持所有文件类型，一键下载

### 🏷️ 交互功能
- **@提及** - 输入 `@用户名` 或双击成员列表
- **回复消息** - 双击消息或左滑（移动端）
- **跳转原消息** - 点击回复引用
- **Markdown 支持** - 粗体、斜体、代码、链接
- **代码高亮** - 支持代码块展开/折叠

### 🛡️ 存储管理
- 单文件限制：200MB
- 房间存储限制：500MB
- 全局存储限制：2GB
- 自动清理：房间过期、/clear 命令、孤儿文件（24h）

### 👑 管理功能
- `/clear` - 清空聊天和文件
- `/kick @用户` - 踢出用户
- `/pass [密码]` - 设置/取消密码
- `/help` - 查看帮助

## 📊 性能指标

| 指标 | 数值 |
|------|------|
| 内存占用 | 40-50MB |
| CPU 占用 | <1% (空闲) |
| 磁盘占用 | ~180MB |
| 启动时间 | <2 秒 |
| 并发用户 | 20+ (单房间) |

## 🚀 快速开始

### 方式一：交互式安装（推荐）

```bash
git clone https://github.com/lemmomay/22-claw.git
cd 22-claw/chatroom
./chatroom.sh
```

进入交互式菜单后选择"安装服务"。

### 方式二：手动安装

```bash
# 安装依赖
npm install --production

# 启动服务
PORT=28881 node server.js
```

### 方式三：Docker

```bash
docker-compose up -d
```

## 🎨 使用说明

### 创建房间
1. 访问 `http://your-server:28881`
2. 输入房间 ID、昵称
3. 设置房间时长（1-72 小时）
4. 可选：设置密码保护

### 加入房间
1. 使用房间链接直接加入
2. 或手动输入房间 ID 和密码

### 快捷操作
- **双击消息** - 回复
- **双击成员** - @提及
- **左滑消息** - 回复（移动端）
- **点击回复引用** - 跳转到原消息
- **点击图片/视频** - 全屏查看

## 🎯 适用场景

✅ **完美适合：**
- 3-5 好友临时聊天
- 小团队文件分享
- 临时协作讨论
- 活动/会议临时沟通
- 64MB+ 小鸡部署

❌ **不适合：**
- 长期存储需求
- 大规模用户（>50 人）
- 需要用户系统
- 需要持久化

## 📚 文档

- [项目总结](./PROJECT_SUMMARY.md) - 完整开发历程
- [功能清单](./CHECKLIST.md) - 详细功能列表
- [Docker 部署](./DOCKER.md) - Docker 使用指南

## 🔧 配置

编辑 `src/config.js`：

```javascript
module.exports = {
  PORT: 28881,                    // 服务端口
  MAX_FILE_SIZE: 200 * 1024 * 1024,  // 200MB
  MAX_ROOM_STORAGE: 500 * 1024 * 1024, // 500MB
  MAX_TOTAL_STORAGE: 2 * 1024 * 1024 * 1024, // 2GB
  GRACE_PERIOD_MS: 30 * 60 * 1000,  // 30 分钟
};
```

## 🛠️ 技术栈

- **后端**: Node.js + Express + WebSocket
- **前端**: HTML5 + CSS3 + Vanilla JavaScript
- **存储**: 文件系统（无数据库）
- **部署**: systemd / OpenRC / Docker

## 📦 项目结构

```
chatroom/
├── server.js              # 主服务
├── src/
│   ├── config.js         # 配置
│   ├── RoomManager.js    # 房间管理
│   ├── StorageManager.js # 存储管理
│   ├── CommandHandler.js # 命令处理
│   └── ConnectionHandler.js # 连接处理
├── public/
│   ├── index.html        # 前端页面
│   └── uploads/          # 文件存储
├── chatroom.sh           # 管理脚本
└── README.md
```

## 🔒 安全特性

- ✅ 密码验证
- ✅ 文件类型验证
- ✅ 大小限制
- ✅ XSS 防护
- ✅ 存储溢出保护
- ✅ 输入验证

## 🐛 故障排查

### 服务无法启动
```bash
# 检查端口占用
lsof -i :28881

# 查看日志
./chatroom.sh  # 选择"查看日志"
```

### 文件上传失败
- 检查存储空间
- 确认文件大小 <200MB
- 查看 `/health` 端点的存储统计

### 连接断开
- 检查网络连接
- 30 分钟内会自动重连
- 超时后需要重新加入

## 📈 监控

访问 `/health` 查看服务状态：

```json
{
  "status": "ok",
  "rooms": 2,
  "clients": 5,
  "uptime": 3600,
  "storage": {
    "used": "150 MB",
    "max": "2 GB"
  }
}
```

## 🎉 开发历程

- **开发时间**: 约 6 小时
- **代码行数**: 2500+ 行
- **提交次数**: 20+ 次
- **功能数量**: 20+ 个核心功能

详见 [PROJECT_SUMMARY.md](./PROJECT_SUMMARY.md)

## 📝 更新日志

### v1.0.0 (2026-02-27)
- ✅ 实时聊天
- ✅ 图片/视频/音频/文件分享
- ✅ @提及和回复功能
- ✅ 存储管理
- ✅ 管理员命令
- ✅ 断线重连
- ✅ Markdown 支持

## 🤝 贡献

这是一个个人项目，暂不接受外部贡献。

## 📄 许可

MIT License

## 🌟 致谢

感谢 11 的需求和测试反馈！

---

**项目地址**: https://github.com/lemmomay/22-claw  
**在线演示**: http://194.156.162.243:28881

_由 22 和 11 共同完成于 2026-02-27/28_ 🌸
